<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hand Tracking with MediaPipe</title>
  <script type='text/javascript' src='https://www.x3dom.org/download/x3dom.js'> </script>

  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.1/camera_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.1/hands.js" crossorigin="anonymous"></script>
</head>
<body>
  <!-- WEBCAM INPUT -->
  <div class="column">
    <article class="panel is-info">
      <p class="panel-heading">
        Webcam Input
      </p>
      <div class="panel-block">
        <video class="input_video3"></video>
      </div>
    </article>
  </div>

  <x3d width='500px' height='400px'>
    <scene>
      <viewpoint position="0 0 15"></viewpoint>
      <Transform id="fish" translation="0 0 0">
        <!-- <shape> 
          <appearance> 
            <material diffuseColor='1 0 0'></material> 
          </appearance> 
          <box></box> 
        </shape> -->
        <Transform id="body" translation="0 0 0">
          <Inline nameSpaceName="fishBody" url="fishBody.glb" />
        </Transform>
        <!-- <Inline nameSpaceName="fishMouth" url="fishMouth.glb" /> -->
        <Transform id="mouth" translation="0 0 0">
          <Inline nameSpaceName="fishMouth" url="fishMouth.glb" />
        </Transform>
      </Transform>
      
      <Transform scale="1.8 1.8 1.8">
        <Inline nameSpaceName="aquarium" url="aquarium.glb" />
      </Transform>
    </scene>
  </x3d>

  <script>
    const video3 = document.getElementsByClassName('input_video3')[0];

    function onResultsHands(results) {
      // console.log("zde");
      // console.log(results.multiHandLandmarks);
      if (results.multiHandLandmarks) {
        console.log(results.multiHandLandmarks);

        basePos = results.multiHandLandmarks[0][0];
        console.log(basePos.x);

        var x3dPos = document.getElementById('fish');
        x3dPos.setAttribute("translation", `${(basePos.x * 10) - 5} ${(basePos.y * -10) + 5} ${(basePos.z * 10) - 5}`);
        console.log(x3dPos.getAttribute("translation"));

      }
      else {
        console.log("nic");
      }
    }

    const hands = new Hands({locateFile: (file) => {
      return `https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.1/${file}`;
    }});
    hands.onResults(onResultsHands);

    const camera = new Camera(video3, {
      onFrame: async () => {
        await hands.send({image: video3});
      },
      width: 480,
      height: 480
    });
    camera.start();
  </script>
  <!-- Your content goes here -->
  <!-- <script src="./your_script.js"></script> -->
</body>
</html>
